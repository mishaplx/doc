# УПРАВЛЕНИЕ ДОСТУПОМ К ОПЕРАЦИЯМ

- принцип работы
  - политика ограничения доступа включает в себя абсолютное большинство всех видов ограничения доступа (ролевая модель, бизнес-логика и пр.)
  - для определения доступа к операции используются следующие данные:
    - название выполняемой операции
    - подключение к БД (от имени админа)
    - id назначения: `emp_id`
    - аргументы декорируемого метода
  - при отказе в доступе генерируется ошибка. Текст ошибки может носить общий характер `Операция запрещена` или содержать пояснение причины отказа. В зависимости от бизнес-логики
  - списки доступных операций также отправляются на фронт в виде свойства `EnablingActions` запросов, описывающих объект: `getJobsById`, `FindByIdDoc` и пр. Это позволяет корректно отображать доступность элементов GUI

- для установки политики ограничения доступа:
  - прописать в `app.module.ts`: `providers: [ { provide: APP_GUARD, useClass: AccessGuard }, ...]`
  - проверка может быть осуществлена:
    - установкой декоратора `@Aceess` на метод в resolver, например: `@Access(ActionsJob.JOB_CONTROL_CANCEL, ActionsJob.JOB_CONTROL_ADD)`
    - прямым вызовом метода проверки `await this.jobsService.accessJob.valid({...});`. Данный способ рекомендуется использовать в случаях, когда аргументы защищаемого метода не позволяют прямо идентифицировать главный объект (см. ниже)

- ВАЖНО: проверка доступности некоторых операций требует идентификации главного объекта(ов) (проект, дело, поручение и т.п.). В таких случаях осуществляется автоматический поиск данных идентификаторов среди аргументов вызываемого метода

- Правила поиска идентификаторов объектов:
  - аргументы метода, идентифицирующие объект, должны именоваться строго определенным образом:
    - соответствовать одному из списка `ACTION_OBJECTS.keys_in`. При этои регистр букв значения не имеет
  - допускается нахождение идентификаторов во вложенных объектах, например: `{ inputDTO: { job_id: 1, ... }, ...}`
  - не допускается одновременная передача нескольких идентификаторов одного объекта,`{ job_id: 1, jobId: 2, ... }`
  - аргументы метода должны быть в объектах, например: `{ job_id: 1, ... }`
  - не допускатеся передача аргументов вне объектов, например: `1, ...'

- Названия возможных операций являются ЕДИНЫМИ для front и back. Они хранятся в папке `src/BACK_SYNC_FRONT/actions`. Папка имеет одинаковаый путь на фронте и бэке. Все файлы на фронте и бэке в данной папке ДОЛЖНЫ БЫТЬ ИДЕНТИЧНЫМИ.


